---
title: "FinalProject_GameData"
author: "Jack Sylvia"
date: "3/23/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(rvest)
library(stringr)
library(pander)
```


# Liberty League Game Data

## West

#### SLU
```{r}
url_SLU <- "https://saintsathletics.com/sports/baseball/stats/2022"
tab_SLU <- read_html(url_SLU) %>% html_nodes("table")
SLU_GameHitting <- tab_SLU[[7]] %>% html_table(fill = TRUE)
SLU_GamePitching <- tab_SLU[[8]] %>% html_table(fill = TRUE)

SLU_GameHitting_new <- SLU_GameHitting %>%
  head(-1) %>%
  mutate(School = "SLU",
         Division = "West",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = K / BB,
         image = sample("https://www.pngfind.com/pngs/m/293-2932598_st-lawrence-university-logo-png-transparent-png.png", size = 1, replace = TRUE))

SLU_GamePitching_new <- SLU_GamePitching %>%
  head(-1) %>%
  select(-19) %>%
  mutate(School = "SLU",
         Division = "West",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = SO / BB,
         image = sample("https://www.pngfind.com/pngs/m/293-2932598_st-lawrence-university-logo-png-transparent-png.png", size = 1, replace = TRUE))

## used this code below to find accidental duplicated columns
which( duplicated( names( SLU_GamePitching ) ) )
  
```


#### Clarkson
```{r}
url_CU <- "https://clarksonathletics.com/sports/baseball/stats/2022"
tab_CU <- read_html(url_CU) %>% html_nodes("table")
Clarkson_GameHitting <- tab_CU[[7]] %>% html_table(fill = TRUE)
Clarkson_GamePitching <- tab_CU[[8]] %>% html_table(fill = TRUE)

Clarkson_GameHitting_new <- Clarkson_GameHitting %>%
  head(-1) %>%
  mutate(School = "Clarkson",
         Division = "West",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = K / BB,
         image = sample("https://w1.pngwing.com/pngs/125/424/png-transparent-mascot-logo-clarkson-university-clarkson-golden-knights-mens-ice-hockey-clarkson-golden-knights-mens-basketball-clarkson-golden-knights-womens-basketball-clarkson-avenue-athletics.png", size = 1, replace = TRUE))

Clarkson_GamePitching_new <- Clarkson_GamePitching %>%
  head(-1) %>%
  select(-19) %>%
  mutate(School = "Clarkson",
         Division = "West",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = SO / BB,
         image = sample("https://w1.pngwing.com/pngs/125/424/png-transparent-mascot-logo-clarkson-university-clarkson-golden-knights-mens-ice-hockey-clarkson-golden-knights-mens-basketball-clarkson-golden-knights-womens-basketball-clarkson-avenue-athletics.png", size = 1, replace = TRUE))
```

#### Rochester
```{r}
url_UofR <- "https://uofrathletics.com/sports/baseball/stats/2022"
tab_UofR <- read_html(url_UofR) %>% html_nodes("table")
Rochester_GameHitting <- tab_UofR[[7]] %>% html_table(fill = TRUE)
Rochester_GamePitching <- tab_UofR[[8]] %>% html_table(fill = TRUE)

Rochester_GameHitting_new <- Rochester_GameHitting %>%
  head(-1) %>%
  mutate(School = "Rochester",
         Division = "West",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = K / BB,
         image = sample("https://uofrathletics.com/images/logos/site/site.png", size = 1, replace = TRUE))

Rochester_GamePitching_new <- Rochester_GamePitching %>%
  head(-1) %>%
  select(-19) %>%
  mutate(School = "Rochester",
         Division = "West",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = SO / BB,
         image = sample("https://uofrathletics.com/images/logos/site/site.png", size = 1, replace = TRUE))
```

#### RIT
```{r}
url_RIT <- "https://ritathletics.com/sports/baseball/stats/2022"
tab_RIT <- read_html(url_RIT) %>% html_nodes("table")
RIT_GameHitting <- tab_RIT[[7]] %>% html_table(fill = TRUE)
RIT_GamePitching <- tab_RIT[[8]] %>% html_table(fill = TRUE)

RIT_GameHitting_new <- RIT_GameHitting %>%
  head(-1) %>%
  mutate(School = "RIT",
         Division = "West",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = K / BB,
         image = sample("https://www.rit.edu/brandportal/sites/rit.edu.brandportal/files/2020-04/3-color-white%20%281%29.png", size = 1, replace = TRUE))

RIT_GamePitching_new <- RIT_GamePitching %>%
  head(-1) %>%
  select(-19) %>%
  mutate(School = "RIT",
         Division = "West",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = SO / BB,
         image = sample("https://www.rit.edu/brandportal/sites/rit.edu.brandportal/files/2020-04/3-color-white%20%281%29.png", size = 1, replace = TRUE))
```

#### Ithaca
```{r}
url_IC <- "https://athletics.ithaca.edu/sports/baseball/stats/2022"
tab_IC <- read_html(url_IC) %>% html_nodes("table")
Ithaca_GameHitting <- tab_IC[[7]] %>% html_table(fill = TRUE)
Ithaca_GamePitching <- tab_IC[[8]] %>% html_table(fill = TRUE)

Ithaca_GameHitting_new <- Ithaca_GameHitting %>%
  head(-1) %>%
  mutate(School = "Ithaca",
         Division = "West",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = K / BB,
         image = sample("https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Ithaca_logo_from_NCAA.svg/1200px-Ithaca_logo_from_NCAA.svg.png", size = 1, replace = TRUE))

Ithaca_GamePitching_new <- Ithaca_GamePitching %>%
  head(-1) %>%
  select(-19) %>%
  mutate(School = "Ithaca",
         Division = "West",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = SO / BB,
         image = sample("https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/Ithaca_logo_from_NCAA.svg/1200px-Ithaca_logo_from_NCAA.svg.png", size = 1, replace = TRUE))
```

## East

#### Skidmore
```{r}
url_Skid <- "https://skidmoreathletics.com/sports/baseball/stats/2022"
tab_Skid <- read_html(url_Skid) %>% html_nodes("table")
Skidmore_GameHitting <- tab_Skid[[7]] %>% html_table(fill = TRUE)
Skidmore_GamePitching <- tab_Skid[[8]] %>% html_table(fill = TRUE)

Skidmore_GameHitting_new <- Skidmore_GameHitting %>%
  head(-1) %>%
  mutate(School = "Skidmore",
         Division = "East",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = K / BB,
         image = sample("https://www.pinclipart.com/picdir/middle/350-3501802_skidmore-college-skidmore-college-logo-clipart.png", size = 1, replace = TRUE))

Skidmore_GamePitching_new <- Skidmore_GamePitching %>%
  head(-1) %>%
  select(-19) %>%
  mutate(School = "Skidmore",
         Division = "East",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = SO / BB,
         image = sample("https://www.pinclipart.com/picdir/middle/350-3501802_skidmore-college-skidmore-college-logo-clipart.png", size = 1, replace = TRUE))
```

#### RPI
```{r}
url_RPI <- "https://rpiathletics.com/sports/baseball/stats/2022"
tab_RPI <- read_html(url_RPI) %>% html_nodes("table")
RPI_GameHitting <- tab_RPI[[7]] %>% html_table(fill = TRUE)
RPI_GamePitching <- tab_RPI[[8]] %>% html_table(fill = TRUE)

RPI_GameHitting_new <- RPI_GameHitting %>%
  head(-1) %>%
  mutate(School = "RPI",
         Division = "East",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = K / BB,
         image = sample("https://upload.wikimedia.org/wikipedia/commons/thumb/a/a9/RPI_Engineers.svg/1200px-RPI_Engineers.svg.png", size = 1, replace = TRUE))

RPI_GamePitching_new <- RPI_GamePitching %>%
  head(-1) %>%
  select(-19) %>%
  mutate(School = "RPI",
         Division = "East",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = SO / BB,
         image = sample("https://upload.wikimedia.org/wikipedia/commons/thumb/a/a9/RPI_Engineers.svg/1200px-RPI_Engineers.svg.png", size = 1, replace = TRUE))
```

#### Union
```{r}
url_UC <- "https://unionathletics.com/sports/baseball/stats/2022"
tab_UC <- read_html(url_UC) %>% html_nodes("table")
Union_GameHitting <- tab_UC[[7]] %>% html_table(fill = TRUE)
Union_GamePitching <- tab_UC[[8]] %>% html_table(fill = TRUE)

Union_GameHitting_new <- Union_GameHitting %>%
  head(-1) %>%
  mutate(School = "Union",
         Division = "East",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = K / BB,
         image = sample("https://1000logos.net/wp-content/uploads/2021/07/Union-Dutchmen-logo.png", size = 1, replace = TRUE))

Union_GamePitching_new <- Union_GamePitching %>%
  head(-1) %>%
  select(-19) %>%
  mutate(School = "Union",
         Division = "East",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = SO / BB,
         image = sample("https://1000logos.net/wp-content/uploads/2021/07/Union-Dutchmen-logo.png", size = 1, replace = TRUE))
```

#### Bard
```{r}
url_Bard <- "https://bardathletics.com/sports/baseball/stats/2022"
tab_Bard <- read_html(url_Bard) %>% html_nodes("table")
Bard_GameHitting <- tab_Bard[[7]] %>% html_table(fill = TRUE)
Bard_GamePitching <- tab_Bard[[8]] %>% html_table(fill = TRUE)

Bard_GameHitting_new <- Bard_GameHitting %>%
  head(-1) %>%
  mutate(School = "Bard",
         Division = "East",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = K / BB,
         image = sample("https://bardathletics.com/images/logos/site/site.png", size = 1, replace = TRUE))

Bard_GamePitching_new <- Bard_GamePitching %>%
  head(-1) %>%
  select(-19) %>%
  mutate(School = "Bard",
         Division = "East",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = SO / BB,
         image = sample("https://bardathletics.com/images/logos/site/site.png", size = 1, replace = TRUE))
```

#### Vassar
```{r}
url_V <- "https://www.vassarathletics.com/sports/baseball/stats/2022"
tab_V <- read_html(url_V) %>% html_nodes("table")
Vassar_GameHitting <- tab_V[[7]] %>% html_table(fill = TRUE)
Vassar_GamePitching <- tab_V[[8]] %>% html_table(fill = TRUE)

Vassar_GameHitting_new <- Vassar_GameHitting %>%
  head(-1) %>%
  mutate(School = "Vassar",
         Division = "East",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = K / BB,
         image = sample("https://www.kindpng.com/picc/m/238-2385745_vassar-college-athletic-logo-hd-png-download.png", size = 1, replace = TRUE))
  

Vassar_GamePitching_new <- Vassar_GamePitching %>%
  head(-1) %>%
  select(-19) %>%
  mutate(School = "Vassar",
         Division = "East",
         Win = if_else(`W/L`== "W", 1, 0),
         XBH = `2B` + `3B` + HR,
         `K/BB` = SO / BB,
         image = sample("https://www.kindpng.com/picc/m/238-2385745_vassar-college-athletic-logo-hd-png-download.png", size = 1, replace = TRUE))
```

-------------------------------------------

```{r}

## merging all player data in the liberty league into a single table

LLGamePitching_df <- rbind(SLU_GamePitching_new, Clarkson_GamePitching_new, Rochester_GamePitching_new, RIT_GamePitching_new, Ithaca_GamePitching_new, Skidmore_GamePitching_new, RPI_GamePitching_new, Union_GamePitching_new, Bard_GamePitching_new, Vassar_GamePitching_new)

LLGameHitting_df <-
rbind(SLU_GameHitting_new, Clarkson_GameHitting_new, Rochester_GameHitting_new, RIT_GameHitting_new, Ithaca_GameHitting_new, Skidmore_GameHitting_new, RPI_GameHitting_new, Union_GameHitting_new, Bard_GameHitting_new, Vassar_GameHitting_new)

var_choices <- names(LLGamePitching_df)[3:7]

```

-------------------------------------------

### Example Visualizations

```{r}
Win_mod <- glm(Win ~ BB, data = LLGameHitting_df, family = "binomial")
pander(summary(Win_mod))

ggplot(data = LLGameHitting_df, aes(x = XBH, y = Win)) +
  geom_point() +
  geom_jitter(height = 0.05) +
  stat_smooth(method = "glm", method.args = list(family = "binomial"), se = FALSE, fullrange=TRUE)

ggplot(data = LLGamePitching_df, aes(x = ER, y = Win)) +
  geom_point() +
  geom_jitter(height = 0.05) +
  stat_smooth(method = "glm", method.args = list(family = "binomial"), se = FALSE, fullrange=TRUE)
```

```{r}
ggplot(data = LLGameHitting_df %>% filter(`K/BB` <= 30), aes(x = `K/BB`, y = Win)) +
  geom_point() +
  geom_jitter(height = 0.05) +
  stat_smooth(method = "glm", method.args = list(family = "binomial"), se = FALSE, fullrange=TRUE)

ggplot(data = LLGamePitching_df %>% filter(`K/BB` <= 30), aes(x = `K/BB`, y = Win)) +
  geom_point() +
  geom_jitter(height = 0.05) +
  stat_smooth(method = "glm", method.args = list(family = "binomial"), se = FALSE, fullrange=TRUE)+
  facet_wrap(~ School)
```
--------------------------------------------

## shinyApp Game Data


```{r}
library(ggplot2)
library(shiny)
library(plotly)
library(ggimage)

var_choices_GH <- names(LLGameHitting_df)[6:25]
var_choices_GP <- names(LLGamePitching_df)[6:22]


ui_GH <- fluidPage(
  tabsetPanel(type = "tabs",
  tabPanel("Hitting Win Probability",
  sidebarLayout(sidebarPanel(
    selectizeInput("Team", label = "Pick a Team", choices = LLGameHitting_df$School),
    selectizeInput("Stat", label = "Pick a Stat", choices = var_choices_GH)),
    mainPanel(
      plotlyOutput("scatterplot")
    )
  )),
  tabPanel("Pitching Win Probability",
  fluidPage(
  sidebarLayout(sidebarPanel(
    selectizeInput("Team1", label = "Pick a Team", choices = LLGamePitching_df$School),
    selectizeInput("Stat1", label = "Pick a Stat", choices = var_choices_GP)),
    mainPanel(plotlyOutput("scatterplot1"))
  )
  ))
  ))

server_GH <- function(input, output, session) {
  
  df_subGH <- reactive({
    LLGameHitting_df %>%
    filter(School == input$Team)
  })
  
  scatter_plotGH <- reactive({
    ggplot(data = df_subGH(),
aes(x =.data[[input$Stat]], y = Win, label = Opponent)) +
  geom_point() +
  geom_jitter(alpha = 0.05) +
    scale_y_continuous(name="Probability of Winning", limits=c(0, 1)) +
    stat_smooth(method = "glm", method.args = list(family = "binomial"),
    se = FALSE) +
  ylab("Probability of Winning")
  })
  
  scatter_plotly <- reactive({
    ggplotly(scatter_plotGH(), tooltip = "label")
  })
  
  output$scatterplot <- renderPlotly({
    scatter_plotly()
  })
  
  df_subGP <- reactive({
    LLGamePitching_df %>%
    filter(School == input$Team)
  })
  
  scatter_plotGP <- reactive({
    ggplot(data = df_subGP(),
aes(x =.data[[input$Stat1]], y = Win, label = Opponent)) +
  geom_point() +
  geom_jitter(alpha = 0.05) +
      scale_y_continuous(name="Probability of Winning", limits=c(0, 1)) +
    stat_smooth(method = "glm", method.args = list(family = "binomial"),
    se = FALSE) +
  ylab("Probability of Winning")
  })
  
  scatter_plotly1 <- reactive({
    ggplotly(scatter_plotGP(), tooltip = "label")
  })
  
  output$scatterplot1 <- renderPlotly({
    scatter_plotly1()
  })
  
  
}

shinyApp(ui_GH, server_GH)
```

```{r}
library(ggplot2)
library(shiny)
library(plotly)
library(ggimage)

var_choices_GH <- names(LLGameHitting_df)[6:25]
var_choices_GP <- names(LLGamePitching_df)[6:22]


ui_GH <- fluidPage(
  tabsetPanel(type = "tabs",
  tabPanel("Hitting Win Probability",
  sidebarLayout(sidebarPanel(
    selectizeInput("Team", label = "Pick a Team", choices = LLGameHitting_df$School),
    selectizeInput("Stat", label = "Pick a Stat", choices = var_choices_GH)),
    mainPanel(
      plotlyOutput("scatterplot")
    )
  )),
  tabPanel("Pitching Win Probability",
  fluidPage(
  sidebarLayout(sidebarPanel(
    selectizeInput("Team1", label = "Pick a Team", choices = LLGamePitching_df$School),
    selectizeInput("Stat1", label = "Pick a Stat", choices = var_choices_GP)),
    mainPanel(plotlyOutput("scatterplot1"))
  )
  ))
  ))

server_GH <- function(input, output, session) {
  
  df_subGH <- reactive({
    LLGameHitting_df %>%
    filter(School == input$Team)
  })
  
  scatter_plotGH <- reactive({
    ggplot(data = df_subGH(),
aes(x =.data[[input$Stat]], y = Win, label = Opponent)) +
  geom_image(aes(image=image), size = 0.05) +
  geom_jitter(alpha = 0.05) +
    scale_y_continuous(name="Probability of Winning", limits=c(0, 1)) +
    stat_smooth(method = "glm", method.args = list(family = "binomial"),
    se = FALSE) +
  ylab("Probability of Winning")
  })
  
  
  output$scatterplot <- renderPlot({
    scatter_plotGH()
  })
  
  df_subGP <- reactive({
    LLGamePitching_df %>%
    filter(School == input$Team)
  })
  
  scatter_plotGP <- reactive({
    ggplot(data = df_subGP(),
aes(x =.data[[input$Stat1]], y = Win, label = Opponent)) +
  geom_point() +
  geom_jitter(alpha = 0.05) +
      scale_y_continuous(name="Probability of Winning", limits=c(0, 1)) +
    stat_smooth(method = "glm", method.args = list(family = "binomial"),
    se = FALSE) +
  ylab("Probability of Winning")
  })
  
  
  
  output$scatterplot1 <- renderPlot({
    scatter_plotlGP()
  })
  
  
}

shinyApp(ui_GH, server_GH)
```




```{r}
library("ggplot2")
library("ggimage")
set.seed(2017-02-21)
d <- data.frame(x = rnorm(10),
                y = rnorm(10),
                image = sample(c("https://www.r-project.org/logo/Rlogo.png",
                                "https://jeroenooms.github.io/images/frink.png"),
                              size=10, replace = TRUE)
               )
ggplot(d, aes(x, y)) + geom_image(aes(image=image))

ggplot(data = LLGameHitting_df %>% filter(`K/BB` <= 30) %>% filter(School == "Clarkson"), aes(x = `K/BB`, y = Win)) +
  geom_image(aes(image=image), size = 0.1) +
  stat_smooth(method = "glm", method.args = list(family = "binomial"), se = FALSE, fullrange=TRUE)


```

